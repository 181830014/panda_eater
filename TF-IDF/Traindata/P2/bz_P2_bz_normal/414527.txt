Hit this with ObjectArrayMapping.

AbstractCollectionmapping is not derived from CollectionMapping, therefore
if (mapping.isCollectionMapping()) {
  (CollectionMapping)mapping...

throws ClassCastException.