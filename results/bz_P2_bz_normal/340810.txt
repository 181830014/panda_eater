This bug is based on
Bug 340802 - merge problem: existing object referenced by new not cascade merged.

It happens even after bug 340802 is fixed.
To reproduce follow the scenario from bug 340802, but before merge clear the shared cache.

Not that after bug 340802 is fixed the merged B is correct in EntityManager cache.
However both in shared cache and in data base B still has the old state.