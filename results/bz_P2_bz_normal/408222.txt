Created attachment 231070 [details]
NetBeans project in zip file

The following query

select
    new dto.ProductWithFavoriteAttributeDTO(p, f.productId)
from
    Product p
    left join p.favorites f
    on f.user = p.user
where
     p.userId = :userId
	 
is validated and translated, but the SQL fails on execution as follows:

Column 'T2.ID' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list.

Please refer to the attached test case which is a NetBeans ant project that uses the JavaDB database.