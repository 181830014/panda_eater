A class cast can occur setting the identity map class in JPA.

This is because we use the app loader, not the toplink loader, and in some class loader configs this may be wrong somehow.

The EntityManagerSetup should use the TopLink class loader in, updateDescriptorCacheSettings, or perhaps try both.

http://forums.oracle.com/forums/thread.jspa?threadID=643141&tstart=0